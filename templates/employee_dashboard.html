
{% extends "base.html" %}
{% block content %}
<h2>Employee Dashboard</h2>
<div class="card p-3">
    <p><strong>Name:</strong> {{ profile.name }}</p>
    <p><strong>Phone:</strong> {{ profile.phone }}</p>
    <p><strong>Role:</strong> {{ profile.role }}</p>
    <p><strong>Address:</strong> {{ profile.address }}</p>
    <a href="/update-profile" class="btn btn-primary">Update Info</a>
    <a href="/submit-report" class="btn btn-success mt-2">Submit Report</a>
</div>
{% if active_alarm %}
  <div id="alarm-alert" class="alert alert-danger">
    ðŸš¨ An alarm is currently active! Please respond immediately. ðŸš¨
  </div>
{% endif %}
{% if assigned_emergency %}
  <div id="emergency-alert" class="alert alert-danger">
      <strong>Emergency Alert!</strong><br>
      <strong>Type:</strong> {{ assigned_emergency.emergency_type }}<br>
      <strong>Location:</strong> {{ assigned_emergency.location }}<br>
      <form action="{{ url_for('respond_emergency', emergency_id=assigned_emergency.id) }}" method="POST">
          <button type="submit" class="btn btn-warning mt-2">Respond</button>
      </form>
  </div>
{% else %}
  <div class="alert alert-info">
      No current emergency assigned to you.
  </div>
{% endif %}

setInterval(() => {
  fetch('/check_alarm')
      .then(response => response.json())
      .then(data => {
          const alarmDiv = document.getElementById('alarm-alert');
          if (!data.active && alarmDiv) {
              location.reload(); // Reload only if alarm was shown and now turned off
          }
      });
}, 3000);
{% endblock %}
